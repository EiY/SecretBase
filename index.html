<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>~ Secret Base ~</title>
    <style>
      body{display:flex;margin:4em}
      textarea,input,button{border-radius:.4em;border:1px solid #aaa}
      textarea:focus,input:focus{border:1px solid #69f}
      textarea{flex-grow:4;height:80vh;font-size:1.2em;padding:.8em}
      div{flex-grow:1;height:80vh;display:flex;flex-direction:column;justify-content:center;align-items:center}
      input{width:80%;padding:.8em;font-size:2.2em}
      button{width:60%;margin-top:3em;height:4em;border:none;background:#69f;color:#fff;font-size:1.2em}
      button:hover{opacity:80%}
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-nacl/1.3.2/nacl_factory.min.js"></script>
    <script>
      document.addEventListener( "DOMContentLoaded", e => {
        const $ = id => document.getElementById(id);
        const k = _ => _.crypto_hash_string( $("key").value ).subarray( 18, 50 );

        $("enc").addEventListener("click", e =>
          nacl_factory.instantiate(_ => {
            const n = _.crypto_secretbox_random_nonce();
            const c = _.crypto_secretbox( 
              _.encode_utf8( $("txt").value ), n, k(_)
            );
            const r = _.to_hex( n ) + _.to_hex( c );
            $("hex").value = r.match(/.{1,80}/g).join("\n");
          })
        );

        $("dec").addEventListener("click", e => 
          nacl_factory.instantiate(_ => {
            const r = $("hex").value.replace(/\n/g, "" );
            try {
              $("txt").value = _.decode_utf8(
                _.crypto_secretbox_open( _.from_hex( r.substr( 48 ) ), _.from_hex( r.substr( 0, 48 ) ), k(_) )
              );
            } catch ( e ) {
              alert( "Invalid Data" );
            }
          })
        );
      });
    </script>
  </head>
  <body>
    <textarea id="txt"></textarea>
    <div>
      <input type="password" placeholder="passphrase" id="key">
      <button id="enc">&nbsp;&nbsp;&nbsp;&nbsp;Encrypt &raquo;</button>
      <button id="dec">&laquo; Decrypt&nbsp;&nbsp;&nbsp;</button>
    </div>
    <textarea id="hex"></textarea>
  </body>
</html>
